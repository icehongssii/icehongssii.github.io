<html>
  <head>
    <!-- ì‚¬ì´íŠ¸ ì œëª© -->
    <title>icehongssii</title>
    <!-- ì‚¬ì´íŠ¸ favicon -->
    <link
      rel="icon"
      href="/static/assets/icepersimmon.png"
      type="image/x-icon"
    />
    <meta charset="utf-8" />
    <!-- ì½”ë“œí•˜ì´ë¼ì´í„° -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <!-- ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="description" content="MOM, I am gonna rock" />
    <meta property="og:description" content="MOM, I am gonna rock" />
    <meta name="author" content="" />
    <!-- cssíŒŒì¼-->
    <link rel="stylesheet" type="text/css" href="/static/style.css" />
    <!-- RSSí”¼ë“œ-->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="icehongssii"
      href="/feed.xml"
    />
  </head>

  <body>
    <div id="MathJax_Message" style="display: none"></div>
    <header>
      <!--ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
      <div class="container">
        <div class="site-info">
          <a href="/" class="site-title">icehongssii</a>
          <p class="site-description">MOM, I am gonna rock</p>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ì‚¬ì´íŠ¸ë©”íƒ€-->

        <!--í—¤ë”-->
        <div class="grower"></div>
        <!--ë„¤ì´ê²Œì´ì…˜ë°” 3ê°œ-->
        <nav class="site-nav">
          <a href="/career"><img src="/static/assets/sun.svg" /></a>
          <p>ABOUT</p>
        </nav>
        <nav class="site-nav">
          <a href="/posts"><img src="/static/assets/monster.svg" /></a>
          <p>POSTS</p>
        </nav>
        <nav class="site-nav">
          <a href="/tags"><img src="/static/assets/cloud.svg" /></a>
          <p>TAGS</p>
        </nav>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë„¤ì´ê²Œì´ì…˜ë°”3ê°œ-->
      </div>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í—¤ë”-->
    </header>

    <!--ìµœìƒë‹¨ container-->
    <div id="main" role="main" class="container">
      <!--ë³¸ë¬¸article-->
      <article class="post-page">
        <h1 class="title">uvicorn-gunicorn-fastapi does not support ARM64</h1>
        <!--ìˆ˜ì •ë‚ ì§œ-->
        <div class="date">
          <strong
            >ë§ˆì§€ë§‰ìˆ˜ì • 2024-03-12 20:11 - ìµœì´ˆì‘ì„±2024-03-12 20:11
          </strong>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìˆ˜ì •ë‚ ì§œ-->

        <!--ë©”íƒ€ë°ì´í„°-->
        <div class="meta-information">
          <table>
            <tr>
              <td><strong>íƒœê·¸</strong></td>
              <td>
                
                <a href="/tags#python"><span>python</span></a>
                
                <a href="/tags#docker"><span>docker</span></a>
                
                <a href="/tags#troubleshooting"><span>troubleshooting</span></a>
                
                <a href="/tags#CS"><span>CS</span></a>
                
              </td>
            </tr>
            <tr>
              <td><strong>tl;dr</strong></td>
              <td></td>
            </tr>
          </table>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë©”íƒ€ë°ì´í„°-->

        <!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->
        <div class="entry"><h2>ğŸ‘¯â€â™‚ï¸ <a href="https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker">uvicorn-gunicorn-fastapi</a>ê°€ ARM64 Supportë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤</h2>

<pre><code class="dockerfile language-dockerfile">FROM tiangolo/uvicorn-gunicorn:python3.10-slim
LABEL maintainer="Sebastian Ramirez &lt;tiangolo@gmail.com&gt;"
WORKDIR /app
COPY pyproject.toml poetry.lock* /app/
RUN pip install --no-cache-dir poetry
RUN poetry config virtualenvs.create false \
    &amp;&amp; poetry install --no-interaction --no-ansi
COPY ./api /app
</code></pre>

<p>ì´ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ë ¤ê³ í•˜ëŠ”ë°  ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤</p>

<pre><code>WARNING: The requested image's platform (linux/amd64) does not match the detected host platform (linux/arm64/v8) and no specific platform was requested
</code></pre>

<ul>
<li><p>ì¦‰ ë‚´ ë¡œì»¬(ë§¥ë¶ m1) ì—ì„œëŠ” ì•„ë˜ ì´ë¯¸ì§€ ë¹Œë“œê°€ ë˜ì§€ì•ŠëŠ”ë‹¤ ë‚´ ì‹œìŠ¤í…œì˜ ì•„í‚¤í…ì²˜(<code>linux/arm64/v8</code>)ì™€  ì´ë¯¸ì§€ì˜ ì•„í‚¤í…ì²˜(<code>linux/amd64</code>)ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤</p></li>
<li><p>ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ARM ê¸°ë°˜ ì‹œìŠ¤í…œ(ì˜ˆ: Apple M1/M2 ì¹©ì´ ì¥ì°©ëœ Mac, ì¼ë¶€ ARM ê¸°ë°˜ Linux ì„œë²„)ì—ì„œ AMD64(í˜¹ì€ x86_64) ì•„í‚¤í…ì²˜ìš©ìœ¼ë¡œ ë¹Œë“œëœ Docker ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í•  ë•Œ ë°œìƒ</p>

<ul>
<li>CPU = ëª…ë ¹ì–´ ì‹¤í–‰í•˜ëŠ” ì• , </li>
<li>ëª…ë ¹ì–´ ì§‘í•© = CPUê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ ëª¨ìŒ</li>
<li>ê·¼ë° ëª¨ë“  CPUê°€ ë˜‘ê°™ì´ ìƒê¸´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ í•  ìˆ˜ ìˆëŠ”ê²Œ ì•„ë‹ˆë‹¤ ì™œëƒë©´ CPUì œì¡°ì‚¬ë³„ë¡œ(ì•„í‚¤í…ì³ë³„ë¡œ) CPUê°€ ë‹¤ë¥´ê³  ì´ì— ë”°ë¼ ì´í•´ í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ ì§‘í•©ì´ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸!  </li>
<li>ê·¸ëŸ¬ë‹ˆê¹Œ ì§€ê¸ˆ ë‚´ ë…¸íŠ¸ë¶ m1ì€ arm64 ì•„í‚¤í…ì²˜ì´ê³  í•´ë‹¹ ì´ë¯¸ì§€ëŠ” amd64ë§Œ ì§€ì›í•˜ëŠ” ì´ë¯¸ì§€ì´ê¸° ë•Œë¬¸ì— ë‚´ ë…¸íŠ¸ë¶ì´ ì•Œì•„ë“¤ì„ ìˆ˜ ì—†ëŠ” ê²ƒì´ë‹¤</li>
</ul></li>
</ul>

<p><a href="https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker/issues/5">fastapiì‘ì„±ì‚¬ tiangoloëŠ” python ê³µì‹ docker imageëŠ” ë©€í‹° ì•„í‚¤í…ì²˜ ì§€ì›í•˜ì§€ë§Œ ë„ì»¤ í—ˆë¸Œ ìë™ë¹Œë“œëŠ” ARM ì•„í‚¤í…ì²˜ë¡œ ì»´íŒŒì¼ í•  ìˆ˜ ê°€ì—†ë‹¤ê³  í•¨ ë”°ë¼ì„œ ì§ì ‘ ì´ ë¦¬í¬ í´ë¡ í•´ì„œ ìˆ˜ì •í•˜ë¼ê³ í•˜ì§€ë§Œ ì´ìƒì ì´ì§€ëŠ” ì•Šë‹¤ê³ í•œë‹¤</a></p>

<p>ì§ì ‘ì ìœ¼ë¡œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ” ë°©ë²•ì„ ì°¾ì•„ë³´ë‹¤ê°€ Docker buildxë¥¼ ì•Œê²Œë˜ì—ˆìŒ</p>

<hr />

<h2>ğŸ‘¯â€â™‚ï¸ Docker Buildxë¥¼ ì´ìš©í•˜ì</h2>

<ul>
<li>docker buildx ëª…ë ¹ì–´ëŠ” ë©€í‹° ì•„í‚¤í…ì²˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.  ì˜ˆë¥¼ ë“¤ì–´, Linuxì˜ AMD64 ë° ARM64 ì•„í‚¤í…ì²˜ë¥¼ ìœ„í•œ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ë¹Œë“œí•  ìˆ˜ ìˆë‹¤</li>
<li>ì´ buildxëŠ” <code>buildkit</code>ì„ ì‚¬ìš©í•˜ëŠ”ë° <code>buildkit</code>ì€ ìºì‹± ë©”ì»¤ë‹ˆì¦˜ì„ ê°œì„ í•˜ë©°, ë³´ì•ˆì„ ê°•í™”í•˜ê³  ë¹Œë“œ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¬ìˆ˜ìˆê²Œ ë„ì™€ì£¼ëŠ” ë¹Œë“œì—”ì§„ì´ë‹¤. ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì¤‘ì—ëŠ” ë³‘ë ¬ë¹Œë“œë„ ìˆë‹¤..  <mark style="background: #D2B3FFA6;">buildkitì€ Docker Engine v23. 0ë¶€í„° ë””í´íŠ¸ ë¹Œë“œì—”ì§„ì´ë‹¤</mark></li>
</ul>

<p>ë³‘ë ¬ë¹Œë“œëŠ” ì•„ë˜ì™€ ê°™ì€ ê±¸ ì˜ë¯¸í•¨. C++  Goë¥¼ ë² ì´ìŠ¤ë¥¼í•œ ì´ë¯¸ì§€ë¹Œë“œ ê³¼ì •ì´ë‹¤<br />
ë³´ë©´ ì•Œê² ì§€ë§Œ cpp, go ë¹Œë“œ ìŠ¤í…Œì´ì§€ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰ í•  ìˆ˜ ìˆì„ ê²ƒê°™ë‹¤ ê·¸ë¦¬ê³  buildkitì€ ì´ëŸ¬í•œ ë³‘ë ¬ë¹Œë“œë¥¼ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤ </p>

<pre><code class="Dockerfile language-Dockerfile">FROM ubuntu:18.04 AS build-cpp ########### C++ ë¹Œë“œ
RUN apt-get update &amp;&amp; apt-get install -y build-essential
COPY src/cpp .
RUN gcc -o libfoo.so -shared foo.c

FROM golang:1.16 AS build-go ########### Go ë¹Œë“œ 
COPY src/go .
RUN go build -o app

FROM debian:buster
COPY --from=build-cpp libfoo.so .
COPY --from=build-go app .
</code></pre>

<p>í•œ ë²ˆ ìœ„ì˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ í•´ë´¤ë‹¤(ë‚´ ì‘ì—…ë””ë ‰í† ë¦¬ì—ëŠ” srcì—†ë‹¤). ì‹ ê¸°í•˜ê²Œë„<br />
ë™ì‹œì— <code>src/go</code>, <code>src/cpp</code>ì—ì„œ ì˜¤ë¥˜ê°€ ë‚œë‹¤!<br />
<img src="https://i.imgur.com/9nKMAxH.png" alt="" /></p>

<p>ì—¬íŠ¼ ë‹¤ì‹œ ë³¸ë¡ ìœ¼ë¡œ ëŒì•„ì™€ì„œ ë©€í‹° ì•„í‚¤í…ì²˜ ë¹Œë“œë¥¼ ìœ„í•´ ì´ë¯¸ì§€ë¥¼ buildxë¡œ ë¹Œë“œí•œë‹¤.</p>

<pre><code>docker buildx build --platform linux/arm64/v8 -t icehongssi/uvicorn-gunicorn-fastapi-arm:latest  --load
</code></pre>

<p>ê° ì˜µì…˜ì— ëŒ€í•œ ì„¤ëª… ê·¸ë¦¬ê³  docker build</p>

<ul>
<li><code>--platform linux/amd64, linux/arm64/v8</code> :ë¹Œë“œ ëŒ€ìƒìœ¼ë¡œ AMD64(ì¼ë°˜ì ì¸ x86_64 ì•„í‚¤í…ì²˜ ì»´í“¨í„°ì—ì„œ ì‚¬ìš©ë¨)ì™€ ARM64(ARM v8, ì˜ˆë¥¼ ë“¤ì–´ ìƒˆë¡œìš´ Apple Silicon Macsë‚˜ ë§ì€ ìµœì‹  Android ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì‚¬ìš©ë¨) ì•„í‚¤í…ì²˜ë¥¼ ì§€ì •í•¨. ë¡œì»¬ì—ì„œë§Œ ì‚¬ìš© í•  ê²ƒì´ë¯€ë¡œ arm64ë¡œ ëª…ì‹œí•œë‹¤ </li>
<li><code>--push</code> : ì›ë˜ ê·¸ëƒ¥ <code>dockr build</code> ì—ì„œëŠ” ë¹Œë“œ í›„ì— ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ ê³§ë°”ë¡œ í‘¸ì‹œ í•  ìˆ˜ ì—†ë‹¤ í•˜ì§€ë§Œ buildxì—ì„œëŠ” --pushë¥¼ í†µí•´ ë¹Œë“œ ì™„ë£Œí›„ ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œ ë˜ëŠ” ì„¤ì •ëœ ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œí•  ìˆ˜ ìˆë‹¤ </li>
<li><code>--load</code> : ê³§ë°”ë¡œ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ë¡œ ê°€ì ¸ì˜¨ë‹¤  </li>
</ul>

<p>ë§Œì•½ amd64ë¡œë„ ë¹Œë“œí•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ëœë‹¤.. amd64ëŠ” m1ì—ì„œ í˜¸í™˜ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì €ì¥í•œë‹¤</p>

<pre><code>docker buildx build --platform linux/amd64,linux/arm64/v8 -t icehongssi/uvicorn-gunicorn-fastapi-arm:latest --push . 
</code></pre>

<p><code>docker buildx build</code> ë¥¼ í†µí•´ ë©€í‹° ì•„í‚¤í…ì²˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí–ˆë‹¤ë©´</p>

<p><code>--load</code>ë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ì—ì„œ ë¹Œë“œí–ˆìœ¼ë¯€ë¡œ  ê·¸ë¦¬ê³  ë‚˜ì„œ <code>docker run</code>ìœ¼ë¡œ ì‹¤í–‰ì‹œì¼œì£¼ë©´ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤</p>

<hr />

<h2>ğŸ‘¯â€â™‚ï¸ Ref &amp; LINKS TO THIS PAGE</h2>

<ul>
<li>https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker/issues/5</li>
<li><a href="https://medium.com/@artur.klauser/building-multi-architecture-docker-images-with-buildx-27d80f7e2408">https://medium.com/@artur.klauser/building-multi-architecture-docker-images-with-buildx-27d80f7e2408</a>  </li>
<li><a href="https://collabnix.com/building-arm-based-docker-images-on-docker-desktop-made-possible-using-buildx/">https://collabnix.com/building-arm-based-docker-images-on-docker-desktop-made-possible-using-buildx/</a></li>
<li>buildkit https://www.youtube.com/watch?v=5EuDY6ayNs8</li>
<li>https://blukat.me/2021/07/docker-buildkit-speedup/</li>
<li>https://minkukjo.github.io/devops/2020/04/06/Docker-01/</li>
<li>https://docs.docker.com/reference/cli/docker/buildx/</li>
</ul>
</div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->

        <!--ëŒ“ê¸€-->
        <hr />
        <div>
          <script
            src="https://utteranc.es/client.js"
            repo="icehongssii/icehongssii.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async
          ></script>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ëŒ“ê¸€-->

        <!--í™ì”¨ë°”ë‹¥-->
        <div>
          <center>
            <img src="/static/assets/icepersimmon.png" class="my-icon" />
          </center>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í™ì”¨ë°”ë‹¥-->
      </article>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë³¸ë¬¸article-->
    </div>
    <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìµœìƒë‹¨ container-->

    <footer>
      <div class="container">
        <p><a href="mailto:icehongssii@gmail.com">icehongssii@gmail.com</a></p>
        <p><a href="https://github.com/icehongssii">GitHub @icehongssii</a></p>
      </div>
    </footer>
    <!-- Google Analytics -->
    <!-- End Google Analytics -->
  </body>
</html>