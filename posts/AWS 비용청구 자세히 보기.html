<html>
  <head>
    <!-- 사이트 제목 -->
    <title>icehongssii</title>
    <!-- 사이트 favicon -->
    <link
      rel="icon"
      href="/static/assets/icepersimmon.png"
      type="image/x-icon"
    />
    <meta charset="utf-8" />
    <!-- 코드하이라이터 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <!-- 사이트 메타데이터-->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="description" content="MOM, I am gonna rock" />
    <meta property="og:description" content="MOM, I am gonna rock" />
    <meta name="author" content="" />
    <!-- css파일-->
    <link rel="stylesheet" type="text/css" href="/static/style.css" />
    <!-- RSS피드-->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="icehongssii"
      href="/feed.xml"
    />
  </head>

  <body>
    <div id="MathJax_Message" style="display: none"></div>
    <header>
      <!--사이트 메타데이터-->
      <div class="container">
        <div class="site-info">
          <a href="/" class="site-title">icehongssii</a>
          <p class="site-description">MOM, I am gonna rock</p>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---사이트메타-->

        <!--헤더-->
        <div class="grower"></div>
        <!--네이게이션바 3개-->
        <nav class="site-nav">
          <a href="/career"><img src="/static/assets/sun.svg" /></a>
          <p>ABOUT</p>
        </nav>
        <nav class="site-nav">
          <a href="/posts"><img src="/static/assets/monster.svg" /></a>
          <p>POSTS</p>
        </nav>
        <nav class="site-nav">
          <a href="/tags"><img src="/static/assets/cloud.svg" /></a>
          <p>TAGS</p>
        </nav>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---네이게이션바3개-->
      </div>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---헤더-->
    </header>

    <!--최상단 container-->
    <div id="main" role="main" class="container">
      <!--본문article-->
      <article class="post-page">
        <h1 class="title">AWS 비용청구 자세히 보기</h1>
        <!--수정날짜-->
        <div class="date">
          <strong
            >마지막수정 2024-04-12 13:33 - 최초작성2024-04-12 13:33
          </strong>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--수정날짜-->

        <!--메타데이터-->
        <div class="meta-information">
          <table>
            <tr>
              <td><strong>태그</strong></td>
              <td>
                
                <a href="/tags#aws"><span>aws</span></a>
                
              </td>
            </tr>
            <tr>
              <td><strong>tl;dr</strong></td>
              <td></td>
            </tr>
          </table>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---메타데이터-->

        <!--마크다운변환된내용 본문-->
        <div class="entry"><h2>👯‍♂️ AWS 비용 상세 내역이 보고 싶다면? <code>Bills</code>확인</h2>

<p><img src="https://i.imgur.com/xMRyunq.png" alt="" /></p>

<p>뭘 사용했는데 이렇게 많이 나왔나?</p>

<p>왜 VPC 가격이 저만큼 나왔는지 계속 찾아다녔는데<br />
<code>Billig and Cost Management &gt; Bills</code>   에 가면 기본 화면에 나오는 것보다 더 자세하게 서비스 사용 내역을 볼 수가 있다.</p>

<table>
<thead>
<tr>
  <th>Billing ad Cost Mangement &gt; Cost Explore</th>
  <th>Billing ad Cost Mangement &gt; Bills</th>
</tr>
</thead>
<tbody>
<tr>
  <td><img src="https://i.imgur.com/HxulQoP.png" alt="" /><br></td>
  <td><img src="https://i.imgur.com/d8cQblM.png" alt="" /><br></td>
</tr>
</tbody>
</table>

<p>이번 달 가장 많은 비용을 차지하는 이 세가지 서비스인데 ECS는 사용한 만큼 요금이 지불되므로 패스하고  아래 서비스들이 왜 이런 비용이 나오게 되었는지를 알아보자.</p>

<table>
<thead>
<tr>
  <th>서비스명</th>
  <th>금액</th>
</tr>
</thead>
<tbody>
<tr>
  <td>VPC</td>
  <td>$19.41</td>
</tr>
<tr>
  <td>ELB</td>
  <td>$16.26</td>
</tr>
</tbody>
</table>

<h2>👯‍♂️ 1. VPC 비용</h2>

<p><img src="https://i.imgur.com/fNi0LoC.png" alt="" /></p>

<p>Amazon VPC(가상 사설 클라우드) 자체의 생성 및 사용에 대한 추가 요금은 없다.  </p>

<p>VPC 과금이 되었다면 아래 4가지를 의심해 볼 수 있다.<br />
하지만 보통 <code>퍼블릭 IPv4주소</code>에서 가장 많이 청구가 되는 것 같다.[^1]</p>

<ul>
<li>NAT 게이트웨이</li>
<li><strong>퍼블릭 IPv4주소</strong></li>
<li>IPAM</li>
<li>네트워크 분석</li>
</ul>

<p>해당 서비스들에 대해 잘 알지 못해서<mark style="background: #FFB86CA6;"> NAT 게이트웨이, 퍼블릭 IPv4, IPAM</mark>에 대해 알아보자 ..</p>

<h3>NAT 게이트웨이?</h3>

<p>NAT 게이트웨이(Network Address Translation Gateway)는 AWS에서 제공하는 서비스로, VPC(Virtual Private Cloud) 내의 프라이빗 서브넷에 있는 인스턴스들이 인터넷에 접속할 수 있도록 해주면서도, 인터넷에서는 이 인스턴스들로 직접 접속할 수 없게 하는 역할을 한다.</p>

<ul>
<li>NAT 게이트웨이의 주요 기능:</li>
</ul>

<ol>
<li><strong>인터넷 접속 제공</strong>: 프라이빗 서브넷의 인스턴스가 인터넷에 접속해 필요한 데이터를 다운로드하거나 외부 API와 통신할 수 있도록 한다</li>
<li><strong>인바운드 연결 차단</strong>: 외부에서 프라이빗 서브넷의 인스턴스로 직접 접근하는 것을 차단하여 보안을 강화</li>
<li><strong>IP 주소 마스킹</strong>: NAT 게이트웨이는 프라이빗 서브넷의 인스턴스가 인터넷에 접속할 때 고정된 IP 주소(게이트웨이 자체의 IP)를 사용하여 출발지 IP 주소를 변환하고 응답을 해당 인스턴스로 라우팅</li>
</ol>

<ul>
<li>VPC에 NAT 게이트웨이를 생성하는 경우 게이트웨이를 프로비저닝하고 사용하는 각 <mark style="background: #FFB86CA6;">NAT 게이트웨이 시간</mark>에 대한 요금이 부과된다</li>
</ul>

<h3>퍼블릭 IPv4주소?</h3>

<p>퍼블릭 IPv4 주소는 인터넷에 연결되는 모든 기기가 가지는 특별한 번호임. 인터넷 게임을 하거나 웹사이트 접속 할 때 이 주소를 사용함. 우리집에 우편물 보내려면 정확한 주소가 필요한 것처럼 인터넷에서 각 기기의 정확한 위치 알려주는 주소가 필요한거고 이게 퍼블릭 IPv4주소.</p>

<p>AWS VPC에서 시작하는 대부분의 리소스들은 서로 연결되어야 하기때문에 IP주소와 함께 제공된다. 이때 대부분은 프라이빗 IP주소(인터넷에 공개되지 않음)로 제공되지만 인터넷에 직접 연결되어야하는 경우 퍼블릭  IP주소를 사용한다.<br />
(내가 만든 웹서버를 인터넷 통해 보여주고 싶다든가 할 때)</p>

<p>이때!  <mark style="background: #FFB86CA6;">VPC에서 시작된 리소스와 연결된 모든 퍼블릭 IPv4주소에 요금이 부과되는데. 주소별로 시간당 0.005 USD이다. (리로스 연결과 상관없이 과금됨)</mark></p>

<p>예를들면 아래의 경우 이번달에 <code>IP주소 10개 * 24시간 * 30일 * $0.005 = $36</code> 만큼 과금된다. </p>

<p>• 사용 중인 퍼블릭 IPv4 주소가 1개씩 있는 Amazon EC2 인스턴스 3개<br />
• 사용 중인 퍼블릭 IPv4 주소가 2개 있는 Elastic Load Balancer 1개(포함)<br />
• 사용 중인 퍼블릭 IPv4 주소가 1개 있는 Amazon RDS 데이터베이스 1개<br />
• AWS 계정의 유휴 탄력적 IP 주소 4개</p>

<p><br />
나는 IPv4가 한 5~6개를 쓰고 있는걸로 확인된다.. <code>19.41/(24*30*0.005)</code> (ALB )<br />
그리고 현재 AWS의 어떤 서비스에 이 퍼블릭 IP가 할당되어있는지 확인하려면</p>

<p>AWS에서 IPAM 서비스를이용하면된다🔽</p>

<h3>IPAM?</h3>

<p>IPAM은 AWS VPC IP 주소 관리자로 AWS에서 사용중인 서비스의 IP 주소를 보다 쉽계 추적, 모니터링 할 수 있는 VPC의 기능 중 하나이다.<br />
사용여부와 상관없이 퍼블릭 IP 는 시간당 과금되므로 이런 IPAM을 이용하면 사용하지 않고 있던 IP를 반납해 비용을 절감 할 수도 이있다. 아래의 과정을 진행하면 현재 VPC내 공인IP 주소 사용처를 볼 수 있다 </p>

<p><img src="https://i.imgur.com/ZwU7Oac.png" alt="" />
- 프리티어 : 단일 리전 및 계정 리소스 
- 어드밴스드 티어 : 2개 이상의 리전 및 계정 리소스 (<mark style="background: #FFB86CA6;">IPAM에서 관리하는 활성 IP 주소당 시간당 과금된다</mark> )</p>

<p><img src="https://i.imgur.com/mMCePwq.png" alt="" /></p>

<h2>👯‍♂️ 2. ELB 비용</h2>

<p><img src="https://i.imgur.com/FDn34Uc.png" alt="" /></p>

<h3>LB 종류 ?</h3>

<ul>
<li>ALB(어플리케이션 로드밸런서)
<ul>
<li>HTTP 요청 로드 밸런싱 할 때 </li>
</ul></li>
<li>NLB(네트워크 로드밸랜서)
<ul>
<li>네트워크 전송 프로토콜 (OSI 4계층 TCP, UDP) 로드 밸런싱, 고도 성능 욕 되거나 대기 시간 낮아야 할 경우 </li>
</ul></li>
<li>GLB(게이트웨이 로드밸런서)
<ul>
<li>서드파티 앱 배포하고 실행해야하는경우</li>
</ul></li>
<li>CLB(클래식 로드 밸런서)
<ul>
<li>앱이 EC2 클래식 네트워크 안에 구축된 경우 클래식 로드 밸런서 사용해야함</li>
</ul></li>
</ul>

<h3>LCU란?</h3>

<p>위의 요금을 보면 ALB 사용시간과 <code>LCU 1.062시간</code>도 과금이 되어있다. 이게 뭘까?</p>

<ul>
<li>LUC = Loadbalancer Capacity Unit, 로드 밸런서 용량단위로 AWS가 ALB 요금 산정하는데 사용하는 측정 기준 중 하나이다. 아래의 4가지 기준으로 측정되는데 이 중에 최대 LCU 기준으로 요금이 계산된다
<ul>
<li>새 연결 수 : 초당 새로 설정된 연겴</li>
<li>활성연결 수 : 분당 활성연결수</li>
<li>처리된바이트: HTTP 요청/응답위한 로드 밸런서에 처리된 바이트 수 </li>
<li>규칙평가: LB가 처리한 규칙수와 요청 수의 곱. 처음 10개 처리 규칙은 무료로 이 비용은 = <code>요청속도 * (규칙처리수 - 처음 10개 무료규칙)</code> 처리된다</li>
</ul></li>
<li>이때, 1 LCU는 다음을 포함
<ul>
<li>초당 25개 연결</li>
<li>상호 TLS 사용하는 경우 분당 3,000개 활성 또는 1500개 활성연결</li>
<li>라우팅 되는 모든 요청에 대해 LB 처리하는 데이터는 EC2 경우 시간당 1GB, Lambda 함수 시간당 0.4GB</li>
<li>초당 1000개 규칙평가</li>
</ul></li>
</ul>

<p>예를 들면 APP이 평균 초당 1개  연결 수신, 각 연결 2분간 유지, 클라이언트가 초당 5개 요청보내고 이 요청 및 응답 위해 처리된 바이트 수는 300KB.  LB에 60개의 규칙 구성 해 클라이언트 요청 라우팅한다면 한 달 비용은?(us-east-1 기준)
- 연결 수 = 초당 1개 ,  1LCU가 초당 25개 연결하므로 이는 0.04LCU에 해당
- 활성연결수=분당 2분 유지, 앱이 분당 60개 새 연결, 각 연결 2분 유지 즉 120개 활성 연결 따라서 0.04LCU해당(120개 활성 / 1LCU는 분당 3000개 활성이므로 )
- 처리된바이트수= 각 클라이언트당 300KB 데이터 전송 , 1,080,000바이트 = 1.08GB에 해당
- 초당규칙 = 초당 5개의 요청하므로 속도는 5, (60-10)규칙 따라서 0.25LCU</p>

<p>이때 네가지 기준중 최대 LCU만 과금도는데 1.08LCU이다 따라서 ALB 사용금액 + LCU 사용금액을 더하면 한 달 비용이 청구된다! </p>

<h2>👯‍♂️ Ref &amp; LINKS TO THIS PAGE</h2>

<ul>
<li>https://aws.amazon.com/ko/blogs/korea/new-aws-public-ipv4-address-charge-public-ip-insights/</li>
<li>[^1]: <a href="https://www.reddit.com/r/aws/comments/1ajvdn9/comment/kp3qw8x/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button">reddit, VPC 왜 요금청구 되는거죠?</a></li>
<li>https://aws.amazon.com/ko/elasticloadbalancing/pricing/</li>
</ul>
</div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!--마크다운변환된내용 본문-->

        <!--댓글-->
        <hr />
        <div>
          <script
            src="https://utteranc.es/client.js"
            repo="icehongssii/icehongssii.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async
          ></script>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--댓글-->

        <!--홍씨바닥-->
        <div>
          <center>
            <img src="/static/assets/icepersimmon.png" class="my-icon" />
          </center>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---홍씨바닥-->
      </article>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---본문article-->
    </div>
    <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--최상단 container-->

    <footer>
      <div class="container">
        <p><a href="mailto:icehongssii@gmail.com">icehongssii@gmail.com</a></p>
        <p><a href="https://github.com/icehongssii">GitHub @icehongssii</a></p>
      </div>
    </footer>
    <!-- Google Analytics -->
    <!-- End Google Analytics -->
  </body>
</html>