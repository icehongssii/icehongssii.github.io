<html>
  <head>
    <!-- ì‚¬ì´íŠ¸ ì œëª© -->
    <title>icehongssii</title>
    <!-- ì‚¬ì´íŠ¸ favicon -->
    <link
      rel="icon"
      href="/static/assets/icepersimmon.png"
      type="image/x-icon"
    />
    <meta charset="utf-8" />
    <!-- ì½”ë“œí•˜ì´ë¼ì´í„° -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <!-- ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="description" content="MOM, I am gonna rock" />
    <meta property="og:description" content="MOM, I am gonna rock" />
    <meta name="author" content="" />
    <!-- cssíŒŒì¼-->
    <link rel="stylesheet" type="text/css" href="/static/style.css" />
    <!-- RSSí”¼ë“œ-->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="icehongssii"
      href="/feed.xml"
    />
  </head>

  <body>
    <div id="MathJax_Message" style="display: none"></div>
    <header>
      <!--ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
      <div class="container">
        <div class="site-info">
          <a href="/" class="site-title">icehongssii</a>
          <p class="site-description">MOM, I am gonna rock</p>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ì‚¬ì´íŠ¸ë©”íƒ€-->

        <!--í—¤ë”-->
        <div class="grower"></div>
        <!--ë„¤ì´ê²Œì´ì…˜ë°” 3ê°œ-->
        <nav class="site-nav">
          <a href="/career"><img src="/static/assets/sun.svg" /></a>
          <p>ABOUT</p>
        </nav>
        <nav class="site-nav">
          <a href="/posts"><img src="/static/assets/monster.svg" /></a>
          <p>POSTS</p>
        </nav>
        <nav class="site-nav">
          <a href="/tags"><img src="/static/assets/cloud.svg" /></a>
          <p>TAGS</p>
        </nav>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë„¤ì´ê²Œì´ì…˜ë°”3ê°œ-->
      </div>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í—¤ë”-->
    </header>

    <!--ìµœìƒë‹¨ container-->
    <div id="main" role="main" class="container">
      <!--ë³¸ë¬¸article-->
      <article class="post-page">
        <h1 class="title">k8s-ì„œë¹„ìŠ¤-ì™¸ë¶€ë¡œ ì„œë¹„ìŠ¤ ë…¸ì¶œí•˜ëŠ” ì„¸ê°€ì§€ë°©ë²•</h1>
        <!--ìˆ˜ì •ë‚ ì§œ-->
        <div class="date">
          <strong
            >ë§ˆì§€ë§‰ìˆ˜ì • 2023-05-22T14:55:12 - ìµœì´ˆì‘ì„±2023-05-02T14:55:12
          </strong>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìˆ˜ì •ë‚ ì§œ-->

        <!--ë©”íƒ€ë°ì´í„°-->
        <div class="meta-information">
          <table>
            <tr>
              <td><strong>íƒœê·¸</strong></td>
              <td>
                
                <a href="/tags#2023-k8s-bootcamp"><span>2023-k8s-bootcamp</span></a>
                
                <a href="/tags#k8s"><span>k8s</span></a>
                
              </td>
            </tr>
            <tr>
              <td><strong>tl;dr</strong></td>
              <td>ë…¸ë“œí¬íŠ¸, ì„œë¹„ìŠ¤ ë¡œë“œë°¸ëŸ°ì„œ, ingress ì´ìš©í•´ ì™¸ë¶€ë¡œ ì„œë¹„ìŠ¤ ë…¸ì¶œ</td>
            </tr>
          </table>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë©”íƒ€ë°ì´í„°-->

        <!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->
        <div class="entry"><h2>ì™¸ë¶€ë¡œ ì„œë¹„ìŠ¤ ë…¸ì¶œí•˜ëŠ” ì„¸ê°€ì§€ë°©ë²•</h2>

<p>ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ê¸° ìœ„í•œ ë°©ë²•
- nodeport : ë…¸ë“œ ìì²´ í¬íŠ¸ ì‚¬ìš©í•´ í¬ë“œë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜. ë…¸ë“œ ìì²´ í¬íŠ¸ ì—´ê³  ìˆìŒ. ë¡œë“œ ë°¸ëœì„œ ì‚¬ìš©í•˜ë©´ ì•ì— ì‹¤ì œ ë¡œë“œ ë°¸ëŸ°ì„œê°€ ìƒê¸´ë‹¤ ê·¸ë¦¬ê³  ë’·ìª½ì—ëŠ” í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì§€ì›í•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë…¸ë“œ 3ê°œê°€ ë– ìˆë‹¤ ì¦‰ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°. ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤íŠ¸ëŠ” ë…¸ë“œì˜ í¬íŠ¸ë¥¼ ì—´ê³  ìˆëŠ”ë° ì´ê±¸ ë…¸ë“œí¬íŠ¸ë¼ê³ í•¨. 
- loadbalancer : ì´ëŠ” í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ìì£¼ ì‚¬ìš©í•¨. ì‚¬ë‚´ í”„ë¼ì´ë¹— í´ë¼ìš°ë“œ êµ¬ì„±í•˜ê³  ì´ë¥¼ ì œê³µí•  ë–„ ë¡œë“œë°¸ëŸ°ì‹±í•  ìˆ˜ ìˆë„ë¡ loadbalancerë¼ëŠ”..í´ëŸ¬ìŠ¤í„°ë¥¼ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì œê³µí• ë–„ ë¡œë“œë°¸ëŸ°ì„œë¼ëŠ”ê±¸ ì´ìš©í•˜ë©´ ì‰½ê²Œ ì´ìš©ê°€ëŠ¥í•˜ë‹¤
- ingress : ì¸ê·¸ë ˆìŠ¤ëŠ” í•˜ë‚˜ì˜ ì•„ì´í”¼ë¡œ ë‹¤ìˆ˜ ì„œë¹„ìŠ¤ ì´ìš©ê°€ëŠ¥.. lloadblaancerê°€ L4ë¼ë©´ ingressëŠ” L7. ì–´ë””ë¡œ ì„œë¹„ìŠ¤ ë³´ë‚¼ì§€..? ë„ë©”ì¸ ì´ë¦„ í•´ì„í•˜ëŠ”, ì„œë¹„ìŠ¤ë¥¼ ì–´ë””ë‹¤ê°€ í•´</p>

<p>ë¡œë°¸(ì„œë¹„ìŠ¤), ì‰ê·¸ë ˆìŠ¤ -> í´ë¼ìš°ë“œì—ì„œ ìì£¼ì‚¬ìš©<br />
ë…¸ë“œí¬íŠ¸(ì„œë¹„ìŠ¤) ìì²´ -> ë¬¼ë¦¬ì ì¸ ê¸°ëŠ¥ ì¦‰ vmì—ì„œ ìì£¼ ì‚¬ìš©í•˜ê³  vmì—ì„œ ë¡œë°¸ ì‰ê·¸ë ˆìŠ¤ ì‹¤ìŠµì€ ì¢€ ì–´ë ¤ì›€</p>

<p><img src="https://i.imgur.com/0XowSm3.png" alt="" /></p>

<h2>ë…¸ë“œí¬íŠ¸ë€?</h2>

<p>í¬íŠ¸(svc),íƒ€ê²Ÿí¬íŠ¸(pod) 
- ë…¸ë“œ ìì²´ì— í¬íŠ¸ë¥¼ ì œê³µ 
- ë…¸íŠ¸í¬íŠ¸ê°€ ì—´ë ¤ìˆê³  í´ëŸ¬ìŠ¤í„° ë‚´ì— ì„œë¹„ìŠ¤ê°€ ìˆìŒ ê·¼ë° ì„œë¹„ìŠ¤ê°€ ë™ì‘í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë„¤íŠ¸ì›Œí¬ ë‹´ë‹¹í•˜ëŠ” kube-proxyê°€ íŒ¨í‚·ì„ ë°›ì•„ì„œ ì„œë¹„ìŠ¤ì— ë“±ë¡ëœ ë£°ì„ ì ìš©ì‹œì¼œì¤€ë‹¤. 
- 30001ë²ˆ í¬íŠ¸ê°€ íë¸Œ í”„ë¡ì‹œì— ë“±ë¡ë˜ì–´ ë¼ìš´ë“œë¡œë¹ˆìœ¼ë¡œ ì ì ˆí•œ  podì— ì—°ê²°í•´ì¤€ë‹¤ ë§Œì•½ì— Podê°€ ë…¸ë“œì— ì—†ìœ¼ë©´ kube proxyê°€ ì•Œì•„ì„œ ë‹¤ë¥¸ ë…¸ë“œì— ìˆëŠ” ì ì ˆí•œ kube proxyì™€ ì—°ê²°í•´ Podìœ¼ë¡œ ì—°ê²°í•´ì¤€ë‹¤.
- 3ê°€ì§€ ë‹¨ê³„ -> ë…¸ë“œí¬íŠ¸-ì„œë¹„ìŠ¤-í¬ë“œ
- ì´ë•Œ ë…¸ë“œí¬íŠ¸ì˜ ë²”ìœ„ëŠ” 30000-32767ì‚¬ì´ì— ìˆëŠ”ê²ƒë§Œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤ 
- ë…¸ë“œì— ì§ì ‘ ì—°ê²° í•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ” í¬íŠ¸ë¼ê³  ìƒê°í•˜ë©´ ë  ë“¯í•¨</p>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td><img src="https://i.imgur.com/41F8o98.png" alt="" /></td>
  <td><img src="https://i.imgur.com/TIDIAPd.png" alt="" /></td>
</tr>
</tbody>
</table>

<blockquote>
  <p>[!important]<br />
  êµ¬ê¸€í´ë¼ìš°ë“œì—ì„œ CPì—ì„œ ë°©í™”ë²½ í•´ì²´ì¤˜ì•¼ ë…¸ë“œë¡œ ì§ì ‘ ì ‘ì†ê°€ëŠ¥í•˜ë‹¤</p>
</blockquote>

<p><img src="https://i.imgur.com/g6mqbo8.png" alt="" /></p>

<ul>
<li>í¬íŠ¸ê°€ í•˜ë‚˜ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ í´ëŸ¬ìŠ¤í„° ip í…Œì´ë¸” ì„¤ì •ì— ë”°ë¼ì„œ ë„·í•„í„°(ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ ì •í•´ì§„ ê·œì¹™ ë”°ë¼ í¬ì›Œë”©) ì ì ˆí•œ podìœ¼ë¡œ ë¶„ë°°ê°€ ëœë‹¤ </li>
</ul>

<h2>ë…¸ë“œí¬íŠ¸ ì‹¤ìŠµ</h2>

<p>í•œí¸ ì„œë¹„ìŠ¤ë§Œ ìˆìœ¼ë©´ ì†Œìš©ì´ ì—†ìœ¼ë¯€ë¡œ podì´ ë„ì–´ì ¸ìˆì–´ì•¼í•˜ëŠ”ë° ì•„ë˜ì˜ clusterIPíƒ€ì…ì˜ ì„œë¹„ìŠ¤ì™€ deployë¥¼ ìƒì„±í•˜ëŠ” yamlë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•œë‹¤ </p>

<pre><code class="yaml language-yaml"># http-go-deploy.yaml
apiVersion: v1
kind: Service
metadata:
  name: http-go-svc
spec:
  selector:
    run: http-go
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
---

apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    run: http-go
  name: http-go
spec:
  replicas: 1
  selector:
    matchLabels:
      run: http-go
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: http-go
    spec:
      containers:
      - image: gasbugs/http-go
        name: http-go
        ports:
        - containerPort: 8080
        resources: {}
status: {}                
</code></pre>

<p>ê·¸ë¦¬ê³  ë…¸ë“œí¬íŠ¸ íƒ€ì… ìƒì„±</p>

<pre><code class="yaml language-yaml"># http-go-np.yml
apiVersion: v1
kind: Service
metadata:
  name: http-go-np
spec:
  type: NodePort
  selector:
    run: http-go
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
      nodePort: 30001
</code></pre>

<p><img src="https://i.imgur.com/J7A1z0O.png" alt="" /><br />
ì´ë•Œ ë…¸ë“œí¬íŠ¸ëŠ” external IPê°€ ì—†ëŠ”ë° ì € ì˜†ì— ìˆëŠ” í¬íŠ¸ë¡œ ê°ˆ ìˆ˜ ìˆë‹¤. </p>

<pre><code>kubectl get nodes -o wide
</code></pre>

<p><img src="https://i.imgur.com/2F3w5GN.png" alt="" /></p>

<p>ì´ë•Œ ê° ë…¸ë“œì˜ IP:30001ë²ˆìœ¼ë¡œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ê°€ëŠ¥í•˜ë‹¤ </p>

<blockquote>
  <p>[!important]  ë°©í™”ë²½ì„ ì—´ì–´ë‘¬ì•¼ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ê°€ëŠ¥
  ```
  gcloud compute firewall-rules create http-go-svc-rule --allow=tcp:30001</p>
</blockquote>

<h2>ì„œë¹„ìŠ¤ ë¡œë“œë°¸ëŸ°ì„œë€?</h2>

<ul>
<li>í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©ê°€ëŠ¥</li>
<li>ë…¸ë“œí¬íŠ¸ì˜ í™•ì¥ì„œë¹„ìŠ¤</li>
<li>ë¡œë“œ ë°¸ëŸ°ì„œ IPì£¼ì†Œë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— ì ‘ê·¼ </li>
<li>ì´ë•Œ ì´ ë¡œë“œë°¸ëŸ°ìŠ¤ íƒ€ì…ì˜ ì„œë¹„ìŠ¤ëŠ” ë…¸íŠ¸í¬íŠ¸ì˜ ê¸°ëŠ¥ì„ í¬í•¨í•œë‹¤ </li>
</ul>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td><img src="https://i.imgur.com/dE4IdDF.png" alt="" /></td>
  <td><img src="https://i.imgur.com/UAln1JD.png" alt="" /></td>
</tr>
</tbody>
</table>

<p>vmì—ì„œ ì•ˆë˜ê³  í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì—ì„œë§Œ ê°€ëŠ¥<br />
L4ì¥ë¹„</p>

<p><img src="https://i.imgur.com/U1sKGjQ.png" alt="" /></p>

<p>30533ì€ ì„ì˜ë¡œ ì •í•´ì§„ê±´<br />
ë¡œë“œë°¸ëŸ°ì„œëŠ” ë…¸ë“œí¬íŠ¸ì— ì§ì ‘ ì—°ê²°ë˜ê³  í´ëŸ¬ìŠ¤í„° IPë¡œ í†µì‹ í•¨</p>

<h2>ë¡œë“œë°¸ëŸ°ì„œ + GCP</h2>

<p>ê·¸ì „ì— ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ ì§€ìš°ê³  ì‹¤í–‰ </p>

<pre><code class="yaml language-yaml">
# http-go-lb.yaml
apiVersion: v1
kind: Service
metadata:
  name: http-go-lb
spec:
  type: LoadBalancer
  selector:
    run: http-go
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080

---
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    run: http-go
  name: http-go
spec:
  replicas: 1
  selector:
    matchLabels:
      run: http-go
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        run: http-go
    spec:
      containers:
      - image: gasbugs/http-go
        name: http-go
        ports:
        - containerPort: 8080
        resources: {}
status: {}
</code></pre>

<p>ip í• ë‹¹ ë°›ì„ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼í•¨ğŸ“<br />
ì´ì œëŠ” ë…¸ë“œì™¸ë¶€IP:30001ì•„ë‹ˆë¼ 80í¬íŠ¸ë¡œ ì ‘ì†ë¨<br />
êµ¬ê¸€ í´ë¼ìš°ë“œì—ì„œ GCP ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•´ì¤Œ  </p>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td><img src="https://i.imgur.com/2SOrUJi.png" alt="" /></td>
  <td><img src="https://i.imgur.com/DMlPemq.png" alt="" /></td>
</tr>
</tbody>
</table>

<pre><code>curl 35.202.128.171
</code></pre>

<h2>ğŸ“ ì—°ìŠµë¬¸ì œ</h2>

<ul>
<li>tomcat ë…¸ë“œí¬íŠ¸ë¡œ ì„œë¹„ìŠ¤(30002 í¬íŠ¸)</li>
<li>tomcatì„ ë¡œë“œ ë°¸ëŸ°ìŠ¤ë¡œ ì„œë¹„ìŠ¤í•˜ê¸°(80ë²ˆ í¬íŠ¸)</li>
</ul>

<h2>ğŸ“ ì—°ìŠµë¬¸ì œ ë‹µì•ˆ</h2>

<ul>
<li>tomcat ë…¸ë“œí¬íŠ¸ë¡œ ì„œë¹„ìŠ¤(30002 í¬íŠ¸)</li>
</ul>

<p>í•„ìš”í•œê²Œ  deploy, service(ë…¸ë“œí¬íŠ¸)</p>

<pre><code># í†°ìº£ ë””í”Œë¡œì´
:k  create depoy tomcat --image=consol/tomcat-7.0 --dry-run=client --port=8080 -o yaml &gt;&gt; tomcat-deploy-lb-np.yaml 
</code></pre>

<pre><code># ë…¸ë“œí¬íŠ¸
k create service nodeport tomcat-np --tcp=80:8080 --dry-run=client -o yaml 
</code></pre>

<p>ë¥¼ <code>tomcat-deploy-lb-np.yaml</code>ì— ë¶™ì—¬ë„£ê³ <br />
<code>NodePort: 30002</code> ë¶™ì´ê³  ì„œë¹„ìŠ¤ selectorì— app=tomcatìœ¼ë¡œ íƒœê·¸ ë³€ê²½ </p>

<pre><code># tomcat-deploy-np-lb.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: tomcat
  name: tomcat
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tomcat
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: tomcat
    spec:
      containers:
      - image: consol/tomcat-7.0
        name: tomcat-7-0-xqbmr
        ports:
        - containerPort: 8080
        resources: {}
status: {}
---
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: tomcat-np
  name: tomcat-np
spec:
  ports:
  - name: 80-8080
    port: 80
    protocol: TCP
    targetPort: 8080
    nodePort: 30002
  selector:
    app: tomcat
  type: NodePort
status:
  loadBalancer: {}
</code></pre>

<pre><code>k scale rs [ìƒì„±ëœrsì´ë¦„] --replicas=5
curl [ë…¸ë“œì™¸ë¶€IP]:30002
</code></pre>

<p>ë‘ê°œì˜ ë…¸ë“œì—ì„œ í™•ì¸í•´ë³´ë©´ tomcat í˜ì´ì§€ ë‚˜ì˜¤ëŠ”ê±° í™•ì¸ê°€ëŠ¥</p>

<ul>
<li>ë…¸ë“œí¬íŠ¸ ì‚¬ìš©í•˜ëŠ”ê²½ìš° 30002 í’€ì–´ì•¼</li>
</ul>

<p><img src="https://i.imgur.com/wLIGbJg.png" alt="" /></p>

<ul>
<li>tomcatì„ ë¡œë“œ ë°¸ëŸ°ìŠ¤ë¡œ ì„œë¹„ìŠ¤í•˜ê¸°(80ë²ˆ í¬íŠ¸)</li>
</ul>

<pre><code>k create service loadbalancer tomcat-lb --dry-run=client --tcp=80:8080 -o yaml
</code></pre>

<p>ì´ë•Œ ë‚˜ì˜¨ ê²°ê³¼ <code># tomcat-deploy-np-lb.yaml</code>ì— ë¶™ì—¬ë„£ ê³  <code>k apply -f tomcat-deploy-np-lb.yaml</code><br />
ì´ë•Œ <code>k get svc</code>ì— ë‚˜ì˜¨ ë¡œë“œë°¸ëŸ°ì„œì˜ ì™¸ë¶€ IP:80ìœ¼ë¡œ curlí•´ë³´ë©´ ì ‘ê·¼ê°€ëŠ¥í•œ ê²ƒ í™•ì¸ ê°€ëŠ¥</p>

<h2>Ingressë€?</h2>

<p><img src="https://i.imgur.com/vAUHAkg.png" alt="" /></p>

<p>ingressì•ì— ë°°ì¹˜í•˜ë©´ ë„ë©”ì¸ì´ë‚˜, URI, URLì— ë”°ë¼ì„œ gasbug.com ê·¸ë•ŒëŠ” 1ë²ˆ í¬ë“œ, nodejs.gasbugë©´ 2ë²ˆ í¬ë“œ, 3ë²ˆì§¸ëŠ” URI, ìš”ì²­ë“¤ì–´ì˜¤ë©´ ì„œë¹„ìŠ¤ ì—°ê²°í•œë‹¤.<br />
ì‚¬ìš©ìëŠ” í•˜ë‚˜ì˜ ipë¥¼ ì“°ë©´ì„œ URI, í¬íŠ¸ë“±ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.</p>

<blockquote>
  <p>í•˜ë‚˜ì˜ IPì™€ í•˜ë‚˜ì˜ í¬íŠ¸ë¡œ ë‹¤ìˆ˜ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>
</blockquote>

<h2>Ingress-nginxì´ìš©</h2>

<table>
<thead>
<tr>
  <th></th>
  <th></th>
</tr>
</thead>
<tbody>
<tr>
  <td><img src="https://i.imgur.com/qmMrwtP.png" alt="" /></td>
  <td><img src="https://i.imgur.com/vww5GVl.png" alt="" /></td>
</tr>
</tbody>
</table>

<ul>
<li>í´ëŸ¬ìŠ¤í„°ì•ˆì— ìˆ˜ë§ì€ ë…¸ë“œê°€ìˆê³  ê±°ê¸°ì— nginxë„ì–´ë†“. nginxëŠ” ë‚´ë¶€ì ìœ¼ë¡œ í¬ì›Œë”©í•˜ëŠ” ê¸°ëŠ¥ í¬í•¨í•¨. ê·¼ë° nginx ingressì‚¬ìš©í•˜ë©´ í¬íŠ¸ ë¶„ì„í•´ì„œ ê·¸ ë£°ì„ ë™ì ìœ¼ë¡œ ì„¸íŒ…í•˜ê²Œë” í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  ì™¸ë¶€ ì‚¬ìš©ìê°€ í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ë©´ nginxê°€ ì ì ˆí•œ ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤. </li>
<li>gcpì—ì„œ ì œê³µí•´ì£¼ëŠ” í´ëŸ¬ìŠ¤í„°ì•ì— ALBê°€ nginx ingressê°™ì€ ë£°ì„ ì ìš©í•¨</li>
</ul>

<p>ì´ë•Œ ë‘˜ì˜ ì•„í‚¤í…ì²˜ëŠ” ë‹¤ë¥´ì§€ë§Œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ë¶„ì‚°ë˜ëŠ”ê±°ê³ ,  URIë‚˜ ë„ë©”ì¸ìœ¼ë¡œ ë¶„ì‚°ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ëŠ”ê±´ ê°™ë‹¤.</p>

<h2>Ingress-nginx ì„¤ì¹˜(230522)</h2>

<pre><code class="yaml language-yaml">git clone https://github.com/kubernetes/ingress-nginx/
kubectl apply -k `pwd`/ingress-nginx/deploy/static/provider/baremetal/
# ë§ˆì§€ë§‰ì€ ì›¹í›…êµ¬ì„±ì‚­ì œ. ì´ê¸°ëŠ¥ìœ¼ë¡œ  ingress ì˜ ì•ˆë˜ëŠ” í˜„ìƒìˆì–´ì„œ
kubectl delete validatingwebhookconfigurations.admissionregistration.k8s.io ingress-nginx-admission
</code></pre>

<p>nginx ingressì„¤ì¹˜í•˜ë©´ ingressë¼ëŠ” ë£°ì„ ê·¸ ìì›ì„ ë§Œë“¤ë©´ ì •ë³´ë¥¼ ì½ì–´ì„œ ê·¸ë£°ëŒ€ë¡œ ì„¸íŒ…</p>

<p><img src="https://i.imgur.com/OuVPY9b.png" alt="" /></p>

<h2>Ingressì‹¤ìŠµ</h2>

<pre><code class="yaml language-yaml">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: http-go-ingress
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /welcome/test
spec:
  rules:
    - http:
        paths:
          - pathType: Exact
            path: /welcome/test
            backend:
              service:
                name: http-go
                port: 
                  number: 80
EOF
</code></pre>

<p>ingress-nginx ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìƒì„±ë˜ì–´ìˆë‹¤ </p>

<pre><code>k get all -n  ingress-nginx
</code></pre>

<p>ì„œë¹„ìŠ¤ êµ¬ì„±</p>

<pre><code class="sh language-sh">kubectl create deployment http-go --image=gasbugs/http-go:ingress # ì¸ê·¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ìš© http-go
kubectl expose deployment http-go --port=80 --target-port=8080
</code></pre>

<pre><code>kubectl exec -it http-go-759bdc4cf8-rv9gf --bash
# 404 í˜ì´ì§€ê°€ ëœ¬ê°€
$ curl 127.0.0.1:8080 
# ingress ë£° ì„¤ì •ì´ ì˜ ëœ ëª¨ìŠµ
$ curl 127.0.0.1:8080/welcome/test 

</code></pre>

<p>ì–´ë””ë¡œ ìš”ì²­ë³´ë‚´ì•¼ ë’¤ì—ìˆëŠ” ë…¸ë“œë¡œ ì „ë‹¬í• ìˆ˜ìˆì„ê¹Œ?<br />
kubectl get all -n ingress-nginx ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ <code>ingress-nginx-controller</code>ë¡œ ì ‘ê·¼í•˜ë©´ëœë‹¤</p>

<p><img src="https://i.imgur.com/rQk6NgW.png" alt="" /></p>

<p>ingree-nginx-controller 31471 í¬íŠ¸ë¡œë³´ë‚´ë©´ íŒŒë“œê°€ ì•„ë‹ˆë¼ ì•ì— ìˆëŠ” nginxê°€ ìš”ì²­ì„ ë°›ê²Œ ë˜ë¯€ë¡œ</p>

<p><code>curl 127.0.0.1:31471/welcome/test</code> ë¡œ ìš”ì²­ì„ ë³´ë‚´ì•¼<br />
íŒŒë“œì˜ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤<br />
<img src="https://i.imgur.com/aterMgk.png" alt="" /></p>

<h2>Ref</h2>

<ul>
<li>ì¸í”„ëŸ° - devopsë¥¼ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤</li>
</ul>
</div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->

        <!--ëŒ“ê¸€-->
        <hr />
        <div>
          <script
            src="https://utteranc.es/client.js"
            repo="icehongssii/icehongssii.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async
          ></script>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ëŒ“ê¸€-->

        <!--í™ì”¨ë°”ë‹¥-->
        <div>
          <center>
            <img src="/static/assets/icepersimmon.png" class="my-icon" />
          </center>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í™ì”¨ë°”ë‹¥-->
      </article>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë³¸ë¬¸article-->
    </div>
    <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìµœìƒë‹¨ container-->

    <footer>
      <div class="container">
        <p><a href="mailto:icehongssii@gmail.com">icehongssii@gmail.com</a></p>
        <p><a href="https://github.com/icehongssii">GitHub @icehongssii</a></p>
      </div>
    </footer>
    <!-- Google Analytics -->
    <!-- End Google Analytics -->
  </body>
</html>