<html>
  <head>
    <!-- ì‚¬ì´íŠ¸ ì œëª© -->
    <title>icehongssii</title>
    <!-- ì‚¬ì´íŠ¸ favicon -->
    <link
      rel="icon"
      href="/static/assets/icepersimmon.png"
      type="image/x-icon"
    />
    <meta charset="utf-8" />
    <!-- ì½”ë“œí•˜ì´ë¼ì´í„° -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/dockerfile.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <!-- ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <meta name="description" content="MOM, I am gonna rock" />
    <meta property="og:description" content="MOM, I am gonna rock" />
    <meta name="author" content="" />
    <!-- cssíŒŒì¼-->
    <link rel="stylesheet" type="text/css" href="/static/style.css" />
    <!-- RSSí”¼ë“œ-->
    <link
      rel="alternate"
      type="application/rss+xml"
      title="icehongssii"
      href="/feed.xml"
    />
  </head>

  <body>
    <div id="MathJax_Message" style="display: none"></div>
    <header>
      <!--ì‚¬ì´íŠ¸ ë©”íƒ€ë°ì´í„°-->
      <div class="container">
        <div class="site-info">
          <a href="/" class="site-title">icehongssii</a>
          <p class="site-description">MOM, I am gonna rock</p>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ì‚¬ì´íŠ¸ë©”íƒ€-->

        <!--í—¤ë”-->
        <div class="grower"></div>
        <!--ë„¤ì´ê²Œì´ì…˜ë°” 3ê°œ-->
        <nav class="site-nav">
          <a href="/career"><img src="/static/assets/sun.svg" /></a>
          <p>ABOUT</p>
        </nav>
        <nav class="site-nav">
          <a href="/posts"><img src="/static/assets/monster.svg" /></a>
          <p>POSTS</p>
        </nav>
        <nav class="site-nav">
          <a href="/tags"><img src="/static/assets/cloud.svg" /></a>
          <p>TAGS</p>
        </nav>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë„¤ì´ê²Œì´ì…˜ë°”3ê°œ-->
      </div>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í—¤ë”-->
    </header>

    <!--ìµœìƒë‹¨ container-->
    <div id="main" role="main" class="container">
      <!--ë³¸ë¬¸article-->
      <article class="post-page">
        <h1 class="title">Docker multistage build</h1>

        <!--ìˆ˜ì •ë‚ ì§œ-->
        <div class="date">
          <strong
            >ë§ˆì§€ë§‰ìˆ˜ì • 2024-03-19 00:16 - ìµœì´ˆì‘ì„±2024-03-19 00:16
          </strong>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìˆ˜ì •ë‚ ì§œ-->

        <!--ë©”íƒ€ë°ì´í„°-->
        <div class="meta-information">
          <table>
            <tr>
              <td><strong>íƒœê·¸</strong></td>
              <td>
                
                <a href="/tags#docker"><span>docker</span></a>
                
                <a href="/tags#ci/cd"><span>ci/cd</span></a>
                
              </td>
            </tr>
            <tr>
              <td><strong>tl;dr</strong></td>
              <td>docker image ì‚¬ì´ì¦ˆì™€ ë¹Œë“œì†ë„ ìµœì í™”</td>
            </tr>
          </table>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë©”íƒ€ë°ì´í„°-->

        <!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->
        <div class="entry"><h2>ğŸ‘¯â€â™‚ï¸ Intro &amp; tl;dr</h2>

<p><mark style="background: #CACFD9A6;">ë„ì»¤ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆ ì¤„ì´ëŠ” ë°©ë²•ì¤‘ í•˜ë‚˜ ë©€í‹°ìŠ¤í…Œì´ì§€.<br />
ë©€í‹° ìŠ¤í…Œì´ì§€ëŠ” í•˜ë‚˜ì˜ ë„ì»¤íŒŒì¼ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ” ë‹¨ê³„ë¥¼ ì—¬ëŸ¬ê°œë¡œ ë‚˜ëˆ„ì–´ í•„ìš”í•œ ê²ƒë§Œ ë§ˆì§€ë§‰ì— ë„ì»¤ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ ì§ˆ ìˆ˜ë¡ í•¨!</mark></p>

<p>ì•„ë˜ëŠ” python3.9ì´ë¯¸ì§€ë¥¼ ë² ì´ìŠ¤ë¡œ ì´ë¯¸ ì£¼í”¼í„°ì™€ íŒë‹¤ìŠ¤ ë¹Œë“œì‹œí‚¨ builder ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•œë‹¤</p>

<pre><code class="dockerfile language-dockerfile"># temp stage
FROM python:3.9 as builder
RUN pip wheel --no-cache-dir --no-deps --wheel-dir /wheels jupyter pandas

# final stage
FROM python:3.9-slim
WORKDIR /notebooks
COPY --from=builder /wheels /wheels
RUN pip install --no-cache /wheels/*
</code></pre>

<p>ê·¸ëŸ¼ ì´ë ‡ê²Œ ì‚¬ì´ì¦ˆê°€ ê°€ë²¼ì›Œì§‘ë‹ˆë‹¤</p>

<hr />

<h2>ğŸ‘¯â€â™‚ï¸ ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ ëª©ì </h2>

<ul>
<li>ë„ì»¤ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ëŠ”ê²Œ ì£¼ ëª©ì </li>
<li>ì—¬ëŸ¬ ë‹¨ê³„ì˜ ë¹Œë“œ ë‹¨ê³„ë¥¼ ë§Œë“¤ê³ , ë‹¤ë¥¸ ë‹¨ê³„ì˜ ê²°ê³¼ë¬¼ì—ì„œ íŠ¹ì • í´ë”ë§Œ ë³µì‚¬í•´ì˜¬ ìˆ˜ ìˆë‹¤.</li>
<li>ì»´íŒŒì¼ì´ë‚˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ê³¼ì •ì—ì„œ ë¶€ìˆ˜ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ë¶ˆí•„ìš”í•œ íŒŒì¼ë“¤ì€ ë°°ì œí•˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ì— í•„ìš”í•œ ê²ƒë§Œ ì„ íƒí•˜ì—¬ ê°€ì ¸ì˜¤ë¯€ë¡œ ì´ë¯¸ì§€ë¥¼ ê²½ëŸ‰í™”ì‹œí‚¬ ìˆ˜ ìˆë‹¤.</li>
</ul>

<h2>ğŸ‘¯â€â™‚ï¸ ë‹¤ë¥¸ ë² ì´ìŠ¤ ì´ë¯¸ì§€ì—ì„œ í•„ìš” í•œ ê²ƒë§Œ ê°€ì ¸ ì˜¬ ìˆ˜ ìˆë‹¤</h2>

<pre><code class="dockerfile language-dockerfile">FROM golang:1.16 AS builder
WORKDIR /go/src/github.com/alexellis/href-counter/
RUN go get -d -v golang.org/x/net/html  
COPY app.go ./
RUN CGO_ENABLED=0 go build -a -installsuffix cgo -o app .

FROM alpine:latest  
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /go/src/github.com/alexellis/href-counter/app ./
CMD ["./app"]
</code></pre>

<p>ë‘ ë²ˆì§¸ <code>FROM</code> ì´ ìƒˆ ë¹Œë“œ ìŠ¤í…Œì´ì§€ ì‹œì‘ <code>alpine:latest</code> ë¥¼ ë² ì´ìŠ¤ë¡œ <code>COPY --from=0</code> ì´ ê·¸ì „ ìŠ¤í…Œì´ì§€ì— ìˆëŠ” artifactë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•¨. </p>

<p>Go SDKë‘ ì¤‘ê°„ì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒë“¤ì€ íŒŒì´ë„ ì´ë¯¸ì§€ë¡œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ . </p>

<p>ì˜ˆì œì—ì„œëŠ” <code>--from=builder</code> ìŠ¤í…Œì´ì§€ ì´ë¦„ ì‚¬ìš©</p>

<pre><code>docker build -t alexellis2/href-counter:latest .
</code></pre>

<h2>ğŸ‘¯â€â™‚ï¸ íŠ¹ì • ìŠ¤í…Œì´ì§€ì—ì„œ ë©ˆì¶œ ìˆ˜ ìˆë‹¤!</h2>

<p>ìœ„ì˜ ì˜ˆì œì—ì„œ <code>builder</code>ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ” ê±° ê°€ëŠ¥</p>

<pre><code>docker build --target builder -t alexellis2/href-counter:latest .
</code></pre>

<ul>
<li>--target builder : ì´ ì˜µì…˜ì€ Dockerfileë‚´ì—ì„œ ì—¬ëŸ¬ ë¹Œë“œ ìŠ¤í…Œì´ì§€ ìˆì„ ë•Œ íŠ¹ì • ìŠ¤í…Œì´ì§€ê¹Œì§€ë§Œ ë¹Œë“œí•˜ë¼ëŠ” ì˜ë¯¸ì„!<br />
builder ìŠ¤í…Œì´ì§€ê¹Œì§€ë§Œ ë¹Œë“œ ìˆ˜í–‰í•˜ê³  ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ href-counterì— ì €ì¥í•˜ë¼ëŠ” ì˜ë¯¸ì´ë‹¤</li>
</ul>

<h2>ğŸ‘¯â€â™‚ï¸ Ref &amp; LINKS TO THIS PAGE</h2>

<ul>
<li><p><a href="https://testdriven.io/blog/docker-best-practices/">https://testdriven.io/blog/docker-best-practices/</a></p></li>
<li><p><a href="https://docs.docker.com/build/building/multi-stage/">https://docs.docker.com/build/building/multi-stage/</a></p></li>
</ul>
</div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ë§ˆí¬ë‹¤ìš´ë³€í™˜ëœë‚´ìš© ë³¸ë¬¸-->

        <!--ëŒ“ê¸€-->
        <hr />
        <div>
          <script
            src="https://utteranc.es/client.js"
            repo="icehongssii/icehongssii.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async
          ></script>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ëŒ“ê¸€-->

        <!--í™ì”¨ë°”ë‹¥-->
        <div>
          <center>
            <img src="/static/assets/icepersimmon.png" class="my-icon" />
          </center>
        </div>
        <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---í™ì”¨ë°”ë‹¥-->
      </article>
      <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---ë³¸ë¬¸article-->
    </div>
    <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--ìµœìƒë‹¨ container-->

    <footer>
      <div class="container">
        <p><a href="mailto:icehongssii@gmail.com">icehongssii@gmail.com</a></p>
        <p><a href="https://github.com/icehongssii">GitHub @icehongssii</a></p>
      </div>
    </footer>
    <!-- Google Analytics -->
    <!-- End Google Analytics -->
  </body>
</html>